---
title: "Visualizing Veteran Population"
author: "Jacky Lam"
date: "November 30, 2018"
output:
  html_document: default
  pdf_document: default
---
``` {r, echo=FALSE, warning = FALSE, message = FALSE}
setwd("/Users/Jacky/Documents/R/vets")
library(ggplot2)
library(plotly)
library(dplyr)
library(fst)
library(data.table)
library(rgdal)
library(scales)
library(ggthemes)
library(plotly)
library(tmap)
library(tmaptools)
library(tigris)
library(shiny)
library(stringr)
library(knitr)
library(DT)
```

```{r pressure, echo=FALSE, fig.cap="A quick demographic study of veterans across the United States and New York.", out.width = '100%'}
knitr::include_graphics("/Users/Jacky/Documents/R/website_backend/samuel-branch-442129-unsplash.jpg")
```

I was curious to know what the veteran population was like in the United States, so I went onto the [Department of Veterans Affairs website](https://www.va.gov/vetdata/veteran_population.asp) and found a bunch of spreadsheets and pivot tables on veteran population.

``` {r, echo=FALSE, warning = FALSE, message = FALSE}

setwd("/Users/Jacky/Documents/R/vets")
vet <- read.csv("9L_VetPop2016_County.csv")
# vet$county <- as.data.frame(vet$county)
# vet$state <- as.data.frame(vet$state)
vet[1] <- NULL
vet <- vet[-c(3144:3149),]
vet$County <- as.character(vet$County)
vet$State <- as.character(vet$State)
vet <- as.data.frame(vet)
vet$y2015 <- as.numeric(gsub(",","",vet$y2015))
vet$y2016 <- as.numeric(gsub(",","",vet$y2016))
# vet$y2015 <- as.numeric(vet$y2015)
# vet$y2016 <- as.numeric(vet$y2016)
setDT(vet)

#subset
vet2 = vet[,.(State,y2015)]

#aggregate
vet2 = 
  vet2[,list(population = sum(y2015))
       , by = list(State)]
#us_geo <- states(class = "sf")
#read in shape file
setwd("/Users/Jacky/Documents/R/vets/cb_2017_us_state_500k")
us_geo = read_shape("cb_2017_us_state_500k.shp",as.sf = T,stringsAsFactors = F)
popmap = append_data(us_geo
                      ,vet2
                      ,key.shp = "STUSPS"
                      ,key.data = "State")

#make a map
my_map = 
  tm_shape(popmap) + 
  tm_fill("population", palette = "Oranges"
          ,title = "2015 Veteran Population Density", id = "STUSPS") +
  tm_borders(alpha=.4)

tmap_leaflet(my_map)
```
Here is a breakdown of veteran popuulation density across the US in 2015.  We can see that most veterans live in California, Texas, and Florida. 

Below is a searchable data table of veteran population in 2015 by state:
```{r, echo=FALSE, warning=FALSE, message=FALSE}
datatable(vet2)
```

###New York Veteran Population Density in 2015
```{r, echo=FALSE, warning=FALSE, message=FALSE}
#------NY density map----------------------------------
setwd("/Users/Jacky/Documents/R/vets")
vetny <- read.csv("9L_VetPop2016_County.csv")
# vet$county <- as.data.frame(vet$county)
# vet$state <- as.data.frame(vet$state)
# vetny$Code <- str_trim(vetny$Code)
# vetny$Code <- str_pad(vetny$Code, width = 6, side = "left", pad = "0")
vetny$County <- as.character(vetny$County)
vetny$State <- as.character(vetny$State)
vetny$y2015 <- as.numeric(gsub(",","",vetny$y2015))
# vetny$Code <- as.character(vetny$Code)
# vetny$y2015 <- as.numeric(as.character(vetny$y2015))
# vetny$y2016 <- as.numeric(vetny$y2016)
vetny <- dplyr::filter(vetny, State == "NY")
setDT(vetny)


#subset
vetny1 = vetny[,.(Code, State,County,y2015)]

#aggregate
vetny1 = 
  vetny1[,list(Code, population = y2015, County)
       , by = list(State)]

#read in shape file
setwd("/Users/Jacky/Documents/R/vets/ny_shape2")
nygeo = read_shape("Counties.shp",as.sf = T,stringsAsFactors = F)
nymap = append_data(nygeo
                      ,vetny1
                      ,key.shp = "NAME"
                      ,key.data = "County")
nymap$POP2010 <- as.numeric(nymap$POP2010)

#make a map
ny_map2015 = 
  tm_shape(nymap) + 
  tm_fill("population", palette = "Oranges"
          ,title = "NY Veteran Population Density in 2015", id = "NAME") +
  tm_borders(alpha=.4) 

tmap_leaflet(ny_map2015)

```

Now that we have an idea of the veteran population in the US, lets look more closely at a particular state to see if we can draw any insights on this dataset. The above map shows a raw count of veterans in New York. Suffolk county and Erie county have the most veterans. However, this map can be a little misleading. There are a lot of veterans living in these counties but we do not know anything about the overall population density in each county. Let's take some [census data](https://www.census.gov/programs-surveys/geography.html) and build out veteran proportion in each country.

###New York Veteran Population by percentage
```{r, echo=FALSE, message=FALSE, warning=FALSE}
#Percentage of veterans by county in NY
nymapcopy <- nymap
setDT(nymapcopy)
nypercent <- nymapcopy[,list(pop = population/POP2010 *100)
                , by = list(NAME)]


#read in shape file
setwd("/Users/Jacky/Documents/R/vets/ny_shape2")
nygeoperc = read_shape("Counties.shp",as.sf = T,stringsAsFactors = F)
nymapperc = append_data(nygeoperc
                    ,nypercent
                    ,key.shp = "NAME"
                    ,key.data = "NAME")
# nymap$POP2010 <- as.numeric(nymap$POP2010)

#make a map
ny_map2015perc = 
  tm_shape(nymapperc) + 
  tm_fill("pop", palette = "Oranges"
          ,title = "NY Veteran Pop % Density in 2015", id = "NAME") +
  tm_borders(alpha=.4) 

tmap_leaflet(ny_map2015perc)
```

Now we can see taht Jefferson and Hamilton county have the most veterans by percentage of population within the county. A little Google search found that a VA in both Hamilton County and Jefferson County! 
[VA in Hamilton County](https://veterans.ny.gov/content/hamilton-county-veterans-service-agency-location-1)  
[VA in Jefferson County](https://co.jefferson.ny.us/departments/Veterans)

###Impotance of Visualization
Visualizing this dataset helped understand areas with the highest proportion of veterans does not happen by chance. More veterans will live nearby a VA.  I think this approach would be useful for the VA if they have plans to build new VA hospitals or offices that provide benefits to veterans.

####Resources:  
https://www.census.gov/geo/maps-data/data/cbf/cbf_state.html  
http://gis.ny.gov/gisdata/inventories/details.cfm?DSID=927  
https://www.va.gov/vetdata/

####Interesting Reading:  
https://www.osc.state.ny.us/reports/other/veterans_11_2015.pdf  
https://www.syracuse.com/state/index.ssf/2015/11/nys_veterans_where_they_live_when_they_served.html  